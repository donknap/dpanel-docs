# 快速升级容器

> DPanel Version >= 1.4.2

在 DPanel 面板中你可以对已经创建的容器快速升级。

升级操作会保留当前容器的全部配置，并重新拉取当前容器使用的镜像重新部署容器。

> 如果当前容器使用的镜像未检测新版，【快速升级容器】操作等价于【复制当前容器】\
> 更新完成确认无误后，可使用【清理已停止容器】和【清理未使用镜像】清除掉备份容器数据

需要注意的是，通过面板管理远程主机的容器升级时，请确保面板所处的 docker 环境与远程 docker 环境版本一样
否则可能会在获取参数配置时产生不兼容的情况，从而导致升级失败。

![container-upgrade-1](https://cdn.w7.cc/dpanel/container-upgrade-1.png)

### 检测策略

检测容器升级时你可以配置【检测策略】

- 自动检测，每次进入容器详情页面时，都会检测更新。（为了避免过于频繁的请求，接口有2小时缓存）
- 忽略本次，容器当前使用的镜像未改变时，会忽略检测。
- 永久忽略，会忽略当前容器，其它使用同镜像的容器不受影响。


### 镜像检测更新逻辑

#### docker 镜像命名规范

镜像名 dpanel/dpanel:latest、dpanel/dpanel:lite 等，冒号（:）后面的部分称之为 Tag，其作用
为等同于镜像的版本号。

通常情况下 tag 的构成有以下几种情况：

- 固定标识，比如：dpanel/dpanel:lite、nginx:latest、nginx:mainline 等
- 大版本号，比如：nginx:1.27
- 小版本号，比如：dpanel/dpanel:1.4.0-lite、nginx:1.27.3
- 根据发行时间，比如：minio/minio:RELEASE.2024-10-02T17-50-41Z

在镜像每一个版发布时，会从大到小，依次覆盖 tag 推送。比如 nginx 发布 1.27.4 时，会同时推送至
nginx:1.27、nginx:latest、nginx:mainline、nginx:1.27.4 等，小版本 nginx:1.27.3 则不会被覆盖。

#### 检测更新

- 当你使用 nginx:latest 创建容器后，当 nginx 有更新推送可以检测出更新。
- 当你使用 nginx:1.27 创建容器后，仅当 nginx 发布 1.27.* 相关版本时会检测出更新。
- 当你使用 nginx:1.27.3 创建容器后，通常情况下无法检测出更新。

在创建容器时，需要根据自身情况，选择合适的镜像 tag 以确保可以正常使用【快速升级容器】功能。

#### 更新回退

DPanel 在更新容器时，会停止旧的容器并重新命名【容器名-更新时间】，会将使用的旧镜像命名为【镜像名称-更新时间】。
你在更新容器后，可以重新启动旧容器，以完后更新回退的功能。