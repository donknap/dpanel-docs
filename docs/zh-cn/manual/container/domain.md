# 对外访问

#### 暴露端口

通常情况下，容器对外访问可以通过暴露端口的形式进行，并且多个容器并不能使用同时使用一个端口。

某个容器内部的 Nginx 映射到了宿主的 8080 端口之上。那么可以通过 http://服务器ip:8080 进行访问该容器。

#### 绑定域名

但是在实际场景中都是通过域名的形式进行访问，这时候就需要利用 Nginx 的反向代理功能进行请求的转发。

在配置 Nginx 的时候有两种方式：

- 使用宿主机的 Nginx 进行转发
- 使用容器内的 Nginx 进行转发

##### 使用宿主机的 Nginx 进行转发

通过宿主机的 Nginx 进行转发时（宿主机已经有宝塔之类的管理软件占用了80、443端口），容器内的应用并不需要暴露端口到宿主机。

宿主机的 Nginx 通过以下配置进行转发。这样可能会带来的问题是容器停止再启动后，其 ip 可能会发生变化。

```
location / {
    proxy_pass http://容器在Bridge网络的Ip:容器内端口;
}
```

容器也可以将内部端口暴露到宿主机上进行转发，这样会造成容器可以通过 serverip:端口 的形式访问。

```
location / {
    proxy_pass http://127.0.0.1:容器暴露的端口;
}
```

> 以上两种形式并不能完美的解决转发的问题，只能做为过渡的处理手段

##### 使用容器内的 Nginx 进行转发 （推荐）

通过容器内的 Nginx 进行转发时，容器内的应用并不需要暴露端口到宿主机。但是容器内的 Nginx 的 80、443 端口必须绑定到宿主机上。

此时容器内的 Nginx 通过以下配置进行转发，这时候除 Nginx 以外的容器，并不能直接通过 Ip:端口 的形式进行访问。

```
location / {
    proxy_pass http://容器的内网host:容器内的端口;
}
```

通过容器内部 host 转发的时候，无论容器停止、启动多少次，其 host 都会保持不变。